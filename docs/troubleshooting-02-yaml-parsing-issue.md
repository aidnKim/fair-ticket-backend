# **YAML 8진수 파싱 문제로 인한 포트원 API 인증 실패 해결**

## **📊 문제 배경**

포트원(PortOne) PG사 연동 시 REST API 인증을 위해

application.yml에 API Key를 설정했습니다. 그러나 API 호출 시

**401 Unauthorized**

에러가 지속적으로 발생했습니다.

### **시스템 구조**

```

FE 결제 완료
    ↓
BE에서 포트원 API 호출 (결제 검증)
    ↓
포트원 토큰 발급 API 호출
    ↓
401 Unauthorized 에러 발생

```

---

## **⚠️ 기술적 이슈**

### **증상**

- 포트원 API Key와 Secret을 **application.yml**에 정확히 입력했음에도 불구하고, 서버에서 **다른 값**이 로드됨
- 하드코딩 시에는 정상 동작,  주입 시에만 실패
    
    ```
    @Value
    ```
    

### **디버깅 로그**

```

🔑 API KEY: 16958180786715       ← 실제 로드된 값
🔑 API SECRET: zGoZuXQCfshnp59ps...

// 설정 파일에 입력한 값
api-key: 0366614225701033        ← 원래 값

```

### **문제 원인 분석**

설정한 API Key(

```
0366614225701033
```

)와 로드된 값(

```
16958180786715
```

)이

**완전히 다른 숫자**

로 변환됨.

```

원본: 0366614225701033
변환: 16958180786715

```

---

## **💡 원인 발견: YAML 8진수 파싱**

YAML 스펙에 따르면, **0으로 시작하는 숫자는 8진수(Octal)로 해석**됩니다.

### **YAML 숫자 리터럴 규칙**

| **형식** | **해석** | **예시** |
| --- | --- | --- |
| `123` | 10진수 | 123 |
| `0123` | 8진수 | 83 (10진수 변환) |
| `0x1A` | 16진수 | 26 |
| `"0123"` | 문자열 | "0123" |

### **실제 변환 과정**

```
yaml

# application.yml
portone:
api-key:0366614225701033# 8진수로 해석됨!

```

```

8진수: 0366614225701033
       ↓ (8진수 → 10진수 변환)
10진수: 16958180786715

```

Spring Boot가 YAML을 파싱할 때 **자동으로 8진수 변환**이 발생하여 완전히 다른 값이 주입된 것입니다.

---

## **🛠️ 해결 방법**

### **따옴표로 문자열 처리**

```
yaml

# application.yml (수정 후)
portone:
api-key:"0366614225701033"# 따옴표 추가!
api-secret:"zGoZuXQCfshnp59psAeG..."

```

따옴표로 감싸면 **숫자가 아닌 문자열**로 인식되어 8진수 변환이 발생하지 않습니다.

### **수정 전후 비교**

| **구분** | **설정값** | **로드된 값** |
| --- | --- | --- |
| 수정 전 | `0366614225701033` | `16958180786715` (잘못된 값) |
| 수정 후 | `"0366614225701033"` | `0366614225701033` (정확한 값) |

---

## **📈 결과**

- 포트원 API 토큰 발급 **정상 동작**
- 결제 검증 및 자동 취소 기능 **정상 동작**

---

## **💭 기술적 통찰**

### **핵심 교훈**

1. **YAML은 타입 추론을 자동으로 수행** - 숫자처럼 보이는 값은 숫자로 파싱
2. **0으로 시작하는 숫자는 8진수** - 의도치 않은 값 변환 발생 가능
3. **API Key, 전화번호 등은 반드시 따옴표 처리** - 문자열로 명시적 선언

### **예방 수칙**

```
yaml

# ❌ 위험한 설정
phone:01012345678# 8진수로 해석될 수 있음
api-key:0366614225701033

# ✅ 안전한 설정
phone:"01012345678"# 문자열로 명시
api-key:"0366614225701033"

```

### **YAML 자동 타입 변환 주의사항**

```
yaml

# 모두 자동 변환됨 - 주의!
octal:0123# 8진수 → 83
hex:0x1A# 16진수 → 26
float:1.0# 실수 → 1.0
bool:true# 불린 → true
date:2026-01-12# 날짜 → Date 객체

```